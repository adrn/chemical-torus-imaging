% To-dos
% - See comments labeled "TODO" below

% style guide
% -----------
% - They are abundance RATIOs not abundances.
% - Is it our sample or our stars or what? "the parent sample"
% - We need a "name" for our smooth sine-and-cosine fits (blue curves).
%   "Fourier expansion model"?

\documentclass[modern]{aastex63}

\input{preamble.tex}

% text macros
\newcommand{\methodname}{\textsl{Torus Imaging}}
% Hogg doesn't like these names because they don't refer to the abundance tags
%   Torus Tomography
%     Torus Topography (see what I did there?)
%     Torus--Tangents Topography (TTT)
%     Topographic Torus Mapping (TTM)
%     Torus--Tangent Tags Topography (TTTT)
% Orbit Imaging / Torus Imaging
%   Abundance Orbit Imaging / Abundance Torus Imaging
%   Invariant Orbit Imaging / Invariant Torus Imaging
%   Invariance Imaging
% Abundance-Moment foliation (AMF)
%   Abundance-Moment laminae (AML)
%   Abundance Isopleth Method (AIM)
% Abundance Torus Machinery (ATM)
%   Abundance Torus Method (ATM)
%   Abundance Torus Maschine (ATM)
%   Element Torus Maschine (ETM)  WE NEED RIX TO GIVE US ONE GERMAN WORD FOR THIS
% Toroidal abundance blender (TAB)
%   Toroidal abundance mixer (or mixmaster) (TAM)
% Stationary Abundance Tori (SAT)
%   Stationary Abundance Torus Method (SATM)
% Chemical Tangent Scanning (CT Scan)
% Chemical Tangents
%   Abundance Tangent Method (ATM)
%   Compositional Tangents
% Composition Gradient Method (CGM)
% Abundance Geometry
% The Magical 3-torus of Invariance (MTI)
% Totoro

% Project-specific macros - all others go in preamble.tex
\newcommand{\gaia}{\textsl{Gaia}}
\newcommand{\dr}[1]{\acronym{DR}#1}
\newcommand{\apogee}{\acronym{APOGEE}}
\newcommand{\sdss}{\acronym{SDSS}}
\newcommand{\sdssiv}{\acronym{SDSS-IV}}
\newcommand{\sdssv}{\acronym{SDSS-V}}
\newcommand{\galah}{\acronym{GALAH}}
\newcommand{\hermes}{\acronym{HERMES}}

\newcommand{\mdisk}{\ensuremath{\mathrm{M}_\mathrm{disk}}}
\newcommand{\mratio}{\ensuremath{\mdisk / \mdisk^\star}}


% trust in Hogg
\setlength{\parindent}{1.1\baselineskip}
\renewcommand{\twocolumngrid}{}
\sloppy\sloppypar\raggedbottom\frenchspacing
\renewcommand{\doi}[1]{{\footnotesize\href{https://doi.org/#1}{#1}}}

\shorttitle{geometry of abundances and orbits}
\shortauthors{price-whelan, hogg, et al.}

\begin{document}
\graphicspath{ {figures/} }
\DeclareGraphicsExtensions{.pdf,.eps,.png}

\title{\textbf{%
    Revealing the orbital foliation of phase space\\
    through invariances of element-abundance distributions}}

\newcommand{\affcca}{Center for Computational Astrophysics, Flatiron Institute, 162 Fifth Ave, New York, NY 10010, USA}
\newcommand{\affccpp}{Center for Cosmology and Particle Physics, Department of Physics, New York University, 726 Broadway, New York, NY 10003, USA}
\newcommand{\affmpia}{Max-Planck-Institut f\"ur Astronomie, K\"onigstuhl 17, D-69117 Heidelberg, Germany}
\newcommand{\affcolumbia}{Department of Astronomy, Columbia University, New York, NY 10027, USA}

\author[0000-0003-0872-7098]{Adrian~M.~Price-Whelan}
\affiliation{\affcca}

\author[0000-0003-2866-9403]{David~W.~Hogg}
\affiliation{\affcca}
\affiliation{\affmpia}
\affiliation{\affccpp}

\author[0000-0001-6244-6727]{Kathryn~V.~Johnston}
\affiliation{\affcca}
\affiliation{\affcolumbia}

\author[0000-0003-4996-9069]{Hans-Walter~Rix}
\affiliation{\affmpia}


\begin{abstract}\noindent
  The dynamics of stars in the Milky Way and nearby galaxies is often
  interpreted in an approximation where the gravitational potential is treated
  as simple and integrable and the distribution function time-invariant.
  Under these conditions, Jeans modeling---which relies on computing and
  observing moments of the distribution function---is a standard methodology for
  measuring properties of the mass distribution or potential.
  However, contemporary and near-future spectroscopic surveys measure more than
  just kinematics for huge samples of individual stars within the Milky Way and
  Local Group.
  Here we present an approach for dynamical
  inference---\methodname---that makes use of kinematic measurements
  and stellar tags (e.g., element abundances, stellar ages, or other invariant
  stellar properties).
  The method exploits the fact that there are generically gradients of stellar
  tags on orbital actions (or position and velocity) in the Galaxy, and in
  steady state the distributions of any tags must be invariant with respect to
  time-variable conjugate angles.
  Thus, level sets in moments of the tag distributions must coincide with
  the orbital foliation of phase space!
  We discuss how both classical-statistics and Bayesian forward-modeling methods
  can be built on this idea, and we perform a demonstration with red giant
  stars from the \apogee\ surveys:
  We look at vertical orbit structure in the Milky Way disk, using mean
  abundances to constrain the local disk mass (the disk--halo trade-off at fixed
  circular velocity).
  We find that the disk mass can be constrained (na\"ively) at the $<10$-percent
  level with this new method using only a single moment of a single element
  abundance ratio, demonstrating the promise of combining stellar tags with
  dynamical invariants.
\end{abstract}

\keywords{\raggedright % now from the UAT, not the AAS keyword system
  astrometry
  ---
  astrostatistics
  ---
  chemical~abundances % UGH ELEMENTS
  ---
  galaxy~dynamics
  ---
  Milky~Way~dynamics
  ---
  radial~velocity
  ---
  spectroscopy
  ---
  stellar~kinematics
  ---
  surveys
}

% \section*{}\clearpage
\section{Introduction}
\label{sec:intro}

% Start big, emphasize the big-ness of our ideas, but then zoom in and focus on
% context needed for our specific application / demonstration

A significant goal of modern physics and astronomy is to understand the detailed
properties of dark matter on astrophysical scales as a way of informing
constraints on its fundamental nature \citep[see, e.g., recent reviews
by][]{Bullock:2017, Buckley:2018}.
Significant effort has therefore gone into developing and applying tools for
constraining the mass distributions (i.e., dark matter distributions) of Local
Group galaxies using only kinematic observations of tracers (i.e., stars;
\citealt{Jeans, Binney:2008, somanythings}).
This challenge---using observations of tracer objects to constrain the
underlying force law---is conceptually similar to a much older problem faced by
physicists of the 17th century, who worked out that the gravitational force law
in the Solar System is proportional to the inverse square of the distance from
the Sun \citep{Newton:1687}.
That inference was based on observations that showed that orbits in the Solar
System are closed ellipses, with the Sun at one focus \citep{Kepler:1609}---that
is, they made use of observations of a few tracers (the planets) at many orbital
phases.

In our current efforts to map dark matter, we are instead in a regime where we
observe \emph{many} tracers (stars) but have little or no information about
orbital phase: We observe only a single snapshot (in time) of the stellar
orbits!
The closest we come to seeing orbits directly in the Milky Way is in the study
of stellar streams \citep[e.g.,][]{peoples}, which almost directly encode
(differential) phase information about the orbit of their progenitor systems.
But stellar streams are relatively sparse, and orbits in the Galaxy have more
degrees of freedom than orbits around a point-mass, meaning that we need many
more orbits to span the phase-space and obtain precise constraints on the mass
distribution.
One could argue then that our current task is much harder than Newton and Kepler
had it:
We seek to constrain the global distribution of dark matter around a galaxy---a
time-evolving mass distribution with nontrivial shape and radial
distribution---with only a snapshot of the tracer kinematics (and often only a
subset of phase-space dimensions).

The tools we use to constrain the Galactic force field (i.e., the dark matter
distribution) given only a snapshot of the dynamics are therefore (necessarily)
statistical in nature and do not depend on knowing the orbits of individual
stars.
Instead, these methods typically rely critically on strong assumptions about the
stationarity of the distribution of tracer orbital properties (i.e., a
``steady-state'' or ``equilibrium'' assumption) and the integrability of the
underlying gravitational potential \citep[see, e.g.,][for a review of such
methods as applied to the problem of determining the local dark matter
density]{Read:2014}.
When applied in real-world contexts on stars in the Milky Way or dwarf
spheroidal galaxies, these methods often also require further assumptions, such
as separability of the \acronym{DF}, or the velocity anisotropy profile, or
require simple parametrizations of the \acronym{DF} in order to execute these
analyses.
Generic approaches here typically require parametrized models for the
\acronym{DF} and for the gravitational force field or mass distribution
\citep[e.g.,][]{McMillan:2013, Magorrian:2014, Binney:2014, Magorrian:2019}, but
become computationally prohibitive for large data sets or flexible model forms.

For simplicity and computational efficiency, one of the most ubiquitous
approaches used for dynamical inferences is so-called ``Jeans modeling''
\citep{Binney:2008}, which use the Jeans equations to relate statistical
moments of the tracer distribution function (\acronym{DF}) to properties of the
force field.
While these methods still depend on many of the assumptions laid out above, they
have the great (computational) advantage of not having to deal with modeling the
\acronym{DF} directly.
Jeans modeling (or related analyses) have therefore been used in many
applications:
For example, to derive constraints on the local dark matter density using the
vertical ($z$--$v_z$) kinematics of stars in the solar neighborhood
\citep[e.g.,][]{Jeans:1922, Oort:1932, Bahcall:1984, Buch:2019}, the radial
profile of the Milky Way halo \citep[e.g.,][]{Watkins:2010, Zhai:2018}, the mass
profiles of Local Group satellites \citep[e.g.,][]{Evans:2009, Walker:2011}, and
the mass distributions in elliptical galaxies \citep[e.g.,][]{Romanowsky:2003,
Mamon:2005, Sonnenfeld:2012}, amongst other applications.

A contemporary ``challenge'' to applying these methods on modern data
(especially within the Milky Way) is that stellar kinematic data is now very
precise, and the phase-space is well sampled.
For example, data release (\dr{2}) from the \gaia\ mission
\citep{Gaia-Collaboration:2016, Gaia-Collaboration:2018} has provided full
phase-space kinematics (for a subset of stellar tracers) over a region several
kiloparsecs in size around the Sun.
These data have revealed evidence of dynamical disequilibrium throughout the
Galactic disk and halo \citep{Antoja:2018, Myeong:2018, Koppelman:2018,
Eilers:2020}.
Standard methods for estimating dark matter properties using stellar kinematics
therefore rely on a list of assumptions about dynamical equilibrium, symmetries,
or separability that we now know are strongly violated in the real universe and
Galaxy!
The fact that we still use and apply these methods is a reflection of the fact
that relaxing these assumptions make dynamical inferences \emph{far} more
challenging and computationally expensive.
For example, there are therefore no standard methods (e.g., analogies to Jeans
modeling) when the assumption of dynamical equilibrium is relaxed.

One reason to remain hopeful in our goal (precisely constraining the dark
matter) is that, unlike Kepler and Newton, we have excellent working models of
stars and access to much more information per star than kinematics alone.
For example, spectroscopic surveys have measured the stellar parameters and
element abundances of hundreds of thousands, and soon to be millions, of stars
\citep[e.g.,][]{DR16, Martell:2017, Deng:2012} over large regions of the
Galactic disk and halo.
It is therefore promising to think that utilizing stellar ``tags'' (element
abundances, stellar ages, or other invariant stellar properties) within
dynamical inferences will provide additional information that may help interpret
or model the Galaxy \citep[see, e.g.,][for recent methods that begin to move in
this direction, within the context of equilibrium models]{Sanders:2015,
Das:2016, Binney:2016, Iorio:2020}.

In this \documentname, we are going to demonstrate that stellar surface
abundances can be used to illuminate the orbit structure in the Milky Way, and
are therefore extremely valuable for dynamics.
In our current methodology, like all other dynamical inferences, we will work
only under strong assumptions, so we are still in the business of revealing the
orbits indirectly.
However, our approach is novel and there are many regimes in which it will be
more precise, and require fewer assumptions, than any other method.
\textbf{APW SAYS: Expand out again, make sure to emphasize how general this idea is?}


\section{Methodological Generalities}
\label{sec:generalities}

In a well-mixed, equilibrium population, stars are in a kinematic steady state:
As time goes on, stars move along their orbits, but they do not change their
dynamical invariants (e.g., actions).
In such situations, every location in angle (the coordinates conjugate to
actions) is equally likely, or equally probably populated in any snapshot.
The ``chemical tagging'' insight \citep{Freeman:2002} is that most stars also
preserve their surface element abundances (and other stellar tags) as they
orbit, over many Galactic orbital timescales.
That is, in an integrable galaxy---a galaxy whose stellar orbits are associated
with three invariant actions---the element abundances and the dynamical actions
have something in common: They are invariant with time.
Only the conjugate angle coordinates are time-dependent.
This means that, for a well-mixed population, the detailed element abundances
can only be a function of actions, and never a function of conjugate angles.
That is a remarkably informative constraint on the configuration of the Milky
Way in the space of positions (dimensionality 3), velocities (3), and
detailed abundances (10--30, depending on the spectroscopic survey).

Consider a collection of stars (localized, say, in phase space) for which we
have measured $D$ element abundances.
This collection of stars will in general have a diversity of element abundances:
Their abundances are drawn from some distribution in $D$-dimensional
element-abundance space.
In general, the abundance distribution will depend on position in phase-space:
For example, there are observed radial and vertical abundance gradients in the
Galactic disk \citep{people}.
However, any changes we observe in these element-abundance distributions with
respect to phase-space coordinates (i.e., the six-gradient) must not project
onto the directions of increasing (or decreasing) conjugate angles in phase
space.
All gradients with respect to phase-space coordinates of the element-abundance
distribution must be orthogonal to the directions of increase (or decrease) of
the conjugate angles, and lie in the subspace of the directions of increase (or
decrease) of the dynamical actions.
The trajectories of stars in the phase space (the dynamical tori) must therefore
lie along or describe level surfaces in the element-abundance distribution!

In this \documentname, we demonstrate the utility of these gradients and
relations between element abundances and dynamical invariants in the context of
dynamical inferences in the Milky Way.
We consider stars in our Galaxy because here we can measure six-dimensional
kinematics and element-abundances for individual stars, enabling relatively
simple demonstrations of the concepts here.
However, we note that a generative model built on these concepts would, in
principle, be applicable in more general scenarios, such as for stars in Local
Group satellite galaxies where only a subset of phase-space coordinates are
measured.


\section{Data}
\label{sec:data}

% Notebook: figures/APOGEE-sample.ipynb
\begin{figure}[!tp]
  \begin{center}
  \includegraphics[width=\textwidth]{mh-am-xy.pdf}
  \end{center}
  \caption{%
    The data sample used in this project.
    Each panel shows a 2D histogram of the stars.
    \textsl{Top panel:}
    Bulk abundance ratios measured by \apogee\ and a selection boundary (dashed
    line) used to exclude the ``high-alpha'' stars that are generally older and
    kinematically hotter.
    \textsl{Lower left panel:}
    Positions of the stars in the parent sample projected onto the Galactic
    plane, showing the spherical spatial cut and highly non-uniform (\apogee)
    spatial selection.
    Heliocentric distances to the stars are obtained by na\"ively inverting
    their \gaia\ parallax measurements.
    \textsl{Lower right panel:}
    The distributions of stars in the parent sample in vertical $z, v_z$ phase
    space.
    This panel shows that the sample is less populated at low $z$ (mainly
    because of the \apogee\ selection function), which in turn shows that the
    sample is less populated at certain values of vertical angle, $\theta_z$.
    The methods presented in this paper do not require that all angles are
    equally populated in the sample.
    \label{fig:mh-am-xy}
    }
\end{figure}

In our toy demonstrations below, our main data source is a cross-match between
spectroscopic data from the \apogee\ surveys \citep{Majewski:2017} and
astrometric data from the \gaia\ mission \citep{Gaia-Collaboration:2016,
Gaia-Collaboration:2018}.

\apogee\ is a spectroscopic sub-survey and component of the Sloan Digital Sky
Survey IV (\sdssiv; \citealt{Blanton:2017}) whose main goal is to map
the chemical and dynamical properties of stars across the Milky Way disk.
The survey uses two nearly identical, high-resolution ($R \sim 22,500$;
\citealt{Wilson:2019}), infrared ($H$-band) spectrographs---one in the Northern
hemisphere at Apache Point Observatory (APO) using the SDSS 2.5m telescope
\citep{Gunn:2006}, and one in the Southern hemisphere at Las Campanas
Observatory (LCO) using the 2.5m du Pont telescope \citep{Bowen:1973}.
The primary survey targets are selected with simple color and magnitude cuts
(\citealt{Zasowski:2013, Zasowski:2017}, Santana et al. in prep., Beaton et al.
in prep.), but the sparse angular sky coverage and limited number of fibers per
field lead to a ``pencil-beam''-like sampling of the Milky Way stellar density.
\apogee\ spectra are reduced \citep{Nidever:2015} and then analyzed (i.e., to
measure stellar parameters and abundances) using the \apogee\ Stellar Parameters
and Chemical Abundance Pipeline (\acronym{ASPCAP}; \citealt{ASPCAP,
Holtzman:2018}); here we use abundance measurements from the standard \apogee\
pipeline.

Here we use a recent internal data product (which includes all data taken
through March 2020) from the \apogee\ surveys (post-\dr{16}) that includes
$\approx\%$ more stars than the publicly-available \dr{16} catalogs \citep{DR16,
Jonsson:2020}, but was reduced and processed using the same pipeline used to
produce the \dr{16} release.
This \apogee\ catalog contains calibrated element abundance measurements for 18
elements, but these have a variety of physical origins and a range of
reliabilities and measurement precisions.
For demonstrations below, we therefore focus on a subset of eight, well-measured
(log) abundance ratios selected to have varied astrophysical origins:
\abunratio{Fe}{H}, \abunratio{C}{Fe}, \abunratio{N}{Fe}, \abunratio{O}{Fe},
\abunratio{Mg}{Fe}, \abunratio{Si}{Fe}, \abunratio{Mn}{Fe}, \abunratio{Ni}{Fe}.
In some cases, we focus on just a single element abundance, \abunratio{Mg}{Fe},
which is the most precisely and accurately determined element abundance measured
with the \dr{16} pipeline \citep{Jonsson:2020}.

\gaia\ is primarily an astrometric mission and survey
\citep{Gaia-Collaboration:2016} that obtains sky position, proper motion, and
parallax measurements for $>1$ billion stars limited only by their apparent
magnitudes (\gaia\ $G \lesssim 20.7$).
Here we use parallax and proper motion measurements released in \gaia\ \dr{2}
\citep{Gaia-Collaboration:2018, Gaia-astrometric:2018}.

We cross-match the \apogee\ sample to \gaia\ \dr{2} using the \apogee-provided
\acronym{2MASS} \citep{Skrutskie:2006} identifiers, and the \gaia-provided
cross-match between \gaia\ \dr{2} and the final \acronym{2MASS} point source
catalog \citep{Gaia-crossmatch:2019}.
We then apply a number of quality cuts and other selections to limit the catalog
to chemically thin-disk, red giant branch (RGB) stars with well-measured stellar
parameters and abundances, excluding stars targeted in stellar clusters and
dwarf galaxies, and high signal-to-noise parallax measurements.
In detail, our selections include:
\begin{itemize}
  \item \acronym{ASPCAP} quality flag (\texttt{ASPCAPFLAG}) must not contain
    \texttt{STAR\_BAD} or \texttt{STAR\_WARN},
  \item $3500~\Kel < \Teff < 6500~\Kel$,
  \item $1 < \logg < 3.5$,
  \item combined spectroscopic signal-to-noise ${\rm SNR} > 40$,
  \item \apogee\ targeting bit flags must not indicate that the source was part
    of a special program to observe stellar clusters, dwarf galaxies, M31 stars,
    stellar streams, or moving groups; this \emph{excludes} stars with the
    following bits enabled:
    \begin{itemize}
      \item \texttt{APOGEE\_TARGET1}: (9. 18, 24, 26)
      \item \texttt{APOGEE\_TARGET2}: (10, 18)
      \item \texttt{APOGEE2\_TARGET1}: (9, 18, 20, 21, 22, 23, 24, 26)
      \item \texttt{APOGEE2\_TARGET2}: (10)
      \item \texttt{APOGEE2\_TARGET3}: (5, 14, 15)
    \end{itemize}
  \item stars are part of the ``low-alpha'' (or ``chemical thin disk'')
    population (see polygonal selection in the top panel of
    \figurename~\ref{fig:mh-am-xy}),
  \item \gaia\ parallax $\varpi > 0.4~\mas$,
  \item \gaia\ parallax signal-to-noise $\varpi / \sigma_\varpi > 5$.
\end{itemize}
The \apogee\ catalog contains a small number of duplicates (duplicated source
identifier \texttt{APOGEE\_ID}); To unique-ify our sample in these cases, we
keep only the entry with highest signal-to-noise.
The final parent sample contains 76,559 RGB stars with high-quality \apogee\ and
\gaia\ data.

For each star in the parent sample, we compute na\"ive distance estimates by
inverting the parallax, $d = 1/\varpi$.
While this is generally not a safe way of computing distance from parallaxes
(see, e.g., \citealt{Bailer-Jones:2015}), our sample stars are (by construction)
relatively nearby and have high signal-to-noise parallax measurements.
Using a parallax signal-to-noise selection has its own consequences, especially
in that it makes the sample selection function complex and non-intuitive.
However, since the demonstrations that make use of these distance measurements
below are meant to be illustrative examples, and since our methodology should be
relatively insensitive to selection effects, we ignore these details in what
follows.
This sample is visualized in bulk element abundance ratios and Galactocentric
positions in \figurename~\ref{fig:mh-am-xy}.


\section{Milky Way mass model and computing actions}
\label{sec:mw-model}

Our methodology and demonstrations below rely on computing actions and angles
for stars, which depend on the mass distribution of the Milky Way and the solar
position and motion with respect to a Galactocentric reference frame.

For the solar position, we use the recent precise measurement of the
Sun--Galactic center distance from the \acronym{GRAVITY} collaboration, $r_\odot
= 8.122~\kpc$ \citep{Gravity:2018}.
We set the Sun's height above the Galactic midplane to $z_\odot = -16.6~\pc$
based on experiments done below (note that this is discrepant with the recent
measurement \citealt{Bennett:2019}).
In Galactocentric Cartesian coordinates, we use a right-handed coordinate system
such that the Sun is at $\bs{x}_\odot = (-8.1219, 0, -0.0166)~\kpc$ and the
solar velocity is $\bs{v}_\odot = (12.9, 245.6, 7.78)~\kms$ \citep{Drimmel:2018,
Reid:2004, Gravity:2018}.

We represent the density distribution (or gravitational potential) of the
Milky Way using an idealized, four-component mass model consisting of a
spherical Hernquist bulge \citep{Hernquist:1990}, spherical Hernquist nucleus,
an axisymmetric Miyamoto-Nagai disk \citep{Miyamoto:1975}, and a spherical
Navarro-Frenk-White dark matter halo \citep{Navarro:1996}.
Most of the parameters of these components are fixed to their default values
from the \texttt{MilkyWayPotential} class implemented in the \package{gala}
Python package \citep[v1.1;][]{gala}:
Briefly, the bulge parameters (mass and scale radius) and disk parameters (total
mass, scale height, and scale radius) are initially set to match the
\texttt{MWPotential2014} implemented in \package{galpy} \citep{Bovy:2015}, and
the dark matter halo parameters (virial mass and scale radius) are initially set
by fitting the enclosed mass profile of the mass model to a compilation of
recent enclosed mass measurements.\footnote{As described in
\url{https://gala.adrian.pw/en/latest/potential/define-milky-way-model.html}.}
However, the mass of the disk is then adjusted to match a circular velocity of
$v_{\rm circ}(R_\odot) = 229~\kms$ at the solar radius \citep{Eilers:2019}.
Our fiducial mass model therefore adopts the default \texttt{MilkyWayPotential}
parameters except for the disk mass, which is set to $\mdisk^\star = 6.526
\times 10^{10}~\Msun$.

In addition to the fiducial mass model, we create a set of potential models by
varying the disk mass between $\mratio = 0.4$--1.8 (in steps of 0.1).
For each of these models, we adjust the dark matter halo mass to keep the
circular velocity at the solar radius, $v_{\rm circ}(R_\odot)$, constant.

We compute actions, $\bs{J} = (J_R, J_\phi, J_z)$, and angles, $\bs{\theta} =
(\theta_R, \theta_\phi, \theta_z)$, for a given star by numerically integrating
its orbit in a given Milky Way model and solving for the generating function to
transform from actions computed in a toy potential model to the actions in the
potential model of interest (as defined in \citealt{Sanders:2014}, and
implemented in \package{gala}).\footnote{This method is referred to as the
``O2GF method'' in \citet{Sanders:2016}.}
This method has some tuning parameters related to the total orbital integration
time and time step, and the number of Fourier components to include in the
Fourier expansion used to represent the generating function, $N_{\rm max}$.
Because our parent sample primarily consists of disk stars on loop orbits with
similar orbital periods, we use an Isochrone potential as our toy potential
model, set the total integration time for each star to 128 (radial) orbital
periods, $T=128\,P_r$, and set the time step to $\Delta t = P_r / 256$.
For all stars, we set $N_{\rm max} = 8$ (following \citealt{Sanders:2016}).

We use this procedure to estimate the three actions and angles for all stars in
our parent sample (see \sectionname~\ref{sec:data}) in each of the 15 potential
models with different disk-mass to halo-mass ratios (see above).
We parallelize the computation of the actions using the Python package
\package{schwimmbad} \citep{schwimmbad}.


\section{Motivation from Observed Element Abundance Gradients}
\label{sec:motivation}

% Notebook: figures/APOGEE-zvz-orbits.ipynb
\begin{figure}[!tp]
  \begin{center}
  \includegraphics[width=\textwidth]{abundance-zvz-grid.pdf}
  \end{center}
  \caption{%
    The means of various (logarithmic) abundance ratios as a function of
    Galactic vertical height $z$ and vertical velocity $v_z$.
    Averages are taken in $z, v_z$ boxels.
    The stars at lower $|z|$ and lower $|v_z|$ (that is, the stars with
    lower overall vertical action $J_z$) show higher overall metallicity
    on average, but lower alpha-to-iron.
    These plots are somewhat affected by \apogee\ selection effects, in
    that different $z, v_z$ boxels are projections through different extents
    in Galactocentric radius (see \figurename~\ref{fig:mh-am-xy}).
    This explains some of the visible asymmetries.
  \label{fig:zvz-grid}
  }
\end{figure}

A significant motivation for his work came from plots of elemental abundance
ratios of stars as a function of vertical height $z$ and vertical velocity $v_z$
in Galactocentric Cartesian coordinates.
Examples are shown in \figurename~\ref{fig:zvz-grid}, which show the mean
abundance ratios of stars in bins of their vertical phase-space coordinates,
using data from the \apogee\ and \gaia\ surveys (see
\sectionname~\ref{sec:data}).
In these plots, the eye is drawn to \emph{abundance gradients}:
The stars at small heights and small vertical velocities have different
abundance ratios, on average, than stars at large heights and large vertical
velocities.
But these positional and velocity gradients are related:
Stars at large absolute vertical velocities $v_z$ will, as they orbit, reach
large absolute vertical positions $z$ (far from the Galactic plane, that is),
and stars at large absolute vertical positions will, in the future, reach large
absolute vertical velocities.
That is, the stars will orbit in the Galaxy, which projects onto this $z$--$v_z$
plane as (to zeroth order) roughly elliptical trajectories.
For example, \figurename~\ref{fig:zvz-demo} shows two Galactic orbits computed
in a 3D model for the Milky Way (see \sectionname~\ref{sec:mw-model}) in
different projections of phase-space coordinates:
In the space of $z$--$v_z$ (center panel), a Galactic orbit will form a
close-to-elliptical band whose enclosed area scales with the vertical action,
$J_z$, whose thickness depends on the eccentricity of the orbit, and a given
position on its ``ellipse'' can nearly be mapped to a vertical angle,
$\theta_z$.

% Notebook: figures/zvz-orbit-demo.ipynb
\begin{figure}[!tp]
  \begin{center}
  \includegraphics[width=\textwidth]{zvz-orbit-demo.pdf}
  \end{center}
  \caption{%
    \textsl{Left panel:} Two orbits projected onto the plane of
    Galactic vertical height $z$ and Galactocentric cylindrical radius
    $R$. The orbits fill the surfaces of 3-tori in 6-d phase space.
    \textsl{Middle panel:} The same two orbits, but projected onto the plane
    of vertical height $z$ and vertical velocity $v_z$. In this projection,
    it becomes clearer that the orbital lines are
    colored by the angle $\theta_z$ that is conjugate to vertical action $J_z$.
    The inset shows that conjugate angle wraps non-trivially, because the action
    (by construction) wraps at constant angular velocity, whereas the vertical period
    is a (weak) function of the other orbital phases.
    Note that although this projection is close to ``face on'' for these two
    orbits, the fact that they fills the surfaces of 3-tori means that they
    project to finite-width bands in $z, v_z$ space.
    \textsl{Right panel:} The same two orbits, but now plotted in vertical-action,
    vertical-angle space. In this space, the two orbits trace perfect circles.
  \label{fig:zvz-demo}
  }
\end{figure}

To very high precision, stars do not change their abundances as they orbit.
One consequence of this is a new method for inferring the orbit structure of the
Milky Way:
If two small neighborhoods in phase space lie on the same orbit---that is, they
correspond to the same dynamical actions but with different conjugate
angles---they must contain stars with the same distribution of element
abundances.
This prediction depends on many detailed assumptions, such as that the Galaxy is
(approximately) phase mixed, and that the potential is (approximately) time
invariant and integrable.
And of course the \emph{usefulness} of this prediction for inference depends on
the existence of gradients: If there are no element-abundance-ratio gradients,
there will be no information to work with.

For the sake of illustration and simplicity, we visualize and demonstrate these
concepts using the vertical kinematics of stars in our parent sample.
\figurename~\ref{fig:zvz-mgfe} again shows the mean \abunratio{Mg}{Fe} abundance
ratios (in all panels), but now with two overlaid orbits (white overlaid bands)
computed in three different Milky Way models (with varied disk mass, as
indicated; see \sectionname~\ref{sec:mw-model}).
The two orbits were chosen for illustrative purposes (one with low $J_z$, one
with higher $J_z$), and are defined such that they have the same values of their
three actions $(J_R, J_\phi, J_z)$ in all mass models.
In the fiducial mass model ($\mratio = 1.0$), the two overlaid orbits nearly
follow mean abundance contours.
In the model in which the disk is made less massive (and the halo more massive
to keep the circular velocity constant; $\mratio = 0.4$), the orbits change
shape:
There is more positional extent to an orbit relative to its velocity extent.
If stars were traveling on these lower-disk-mass orbits, they would have to
obtain higher abundances when they are passing through the disk midplane,
and lower abundances when they are at their greatest absolute vertical heights,
which is absurd: Stars do not change their abundances as they orbit.
In our method below, we utilize this fact to infer the disk mass.


% Notebook: figures/APOGEE-zvz-orbits.ipynb
\begin{figure}[!tp]
  \begin{center}
  \includegraphics[width=\textwidth]{zvz-mean-MG_FE}
  \end{center}
  \caption{%
    \textsl{Left panel:} Repeat of the $\mgfe$ panel of \figurename~\ref{fig:zvz-grid}.
    \textsl{Other panels:} Same as the left panel, but with the two orbits
    from \figurename~\ref{fig:zvz-demo}
    over-plotted, for three different Milky Way potentials.
    These three potentials have the fiducial Milky Way disk mass (see text
    for details), or a disk less massive by a factor of 0.4 or more
    massive by a factor of 1.6, as noted in each panel title.
    All potentials are constrained to have a circular velocity at the
    Solar circle of $229\,\kms$.
    \emph{Which of the three panels appears most like the orbits are
    coincident with isopleths of the mean abundance?}
    This question is asked for illustrative purposes only: These
    plots distort the data by projection in phase space.
    In the methods used for the inferences we perform in
    \sectionname~XXX, all averages are performed in tiny
    three-dimensional action neighborhoods; we don't project the data in this way.
  \label{fig:zvz-mgfe}
  }
\end{figure}


\section{Assumptions}
\label{sec:assumptions}

\methodname\ flows from a specific set of assumptions.
That is, we are going to make hard (and sometimes controversial) assumptions.
Our position is not that these assumptions are correct.
Our position is that our
methods are conditionally correct, conditioning on these assumptions.
\begin{description}
\item[integrable] HOGG: There are 3 invariants and 3 angles. This could perhaps be
  relaxed, but we don't know how yet.

\item[well mixed] HOGG: All angles equally likely.
  The well-mixed assumption will be violated substantially in the data;
  we will discuss this more below. But this is the fundamental assumption of
  the vast majority of inferences of the Milky Way mass distribution.
  Snail!

\item[selection] HOGG: Selection depends on position in the Milky Way, but not
  on element abundances. Really it could even depend on velocity! But it can't depend
  on abundances. That might be very slightly wrong.

\item[kinematic measurements] HOGG: Very strong assumption that phase space positions
  in 6-d are accurate and precise. So precise we don't have to generate them, we can
  condition on them!

\item[abundance measurements] HOGG: Assumption that stars in different parts of phase
  space get the same abundance measurements. Questionable in certain kinds of samples.
  HOGG: Oddly I don't think we need to assume that the chemical measurements have good
  (or any) noise estimates. They could be terrible, I think.

\item[smooth gradients] HOGG: Assumption about how the abundances can
  depend on action. Relatedly, the use of action and not log-action
  or zmax or whatever.
\end{description}

\section{Inferences}

There are two families of approaches to \methodname:
In the first---which we will call \emph{classical}---the fact that the
conjugate angles are well mixed is made explicit.
The best-fit or inferred mass-model parameters are those that lead to
no residual dependence of abundances (or mean abundance ratio, or any moment
of the abundance-ratio distribution) on angles.
In the second---which we will call \emph{generative}---a predictive model
is built, in which the high-dimensional abundance distribution is modeled as
a function of actions alone (and not ever angles).
The best-fit or inferred mass-model parameters are those that maximize
the combined probability (density), evaluated at the observed abundances.
The classical approaches are frequentist; the generative approaches produce
likelihoods and can be used in Bayesian inferences.

It may surprise some of our readers that, in this \documentname, we consider
only classical approaches.
The classical approaches are simpler in implementation, make fewer assumptions,
and more explicitly embody the orbits-are-isopleths concept that underlies
the project descriptions we have given above.
We expect, however, that generative approaches, in the long run, will produce
at least slightly more precise inferences, since they will be protected by the
arguments and proofs of Bayesian inference.

In the classical approach, we are asking whether there is a setting of the
mass model that leads to dynamical actions and conjugate angles such that the
means of each abundance ratio does not depend on the conjugate angle $\theta_z$.
Before we ask this, we want to use an abundance-ratio measure that has a compact
empirical distribution.
We make this measure by defining an ``abundance-ratio deviation'' for each star
which is the difference between that star's (logarithmic)
abundance ratio and the mean of the (logarithmic) abundance ratios of the $K=64$
nearest-neighbor stars in dynamical-action-space.
That is, we use the mass model to produce a 3-action vector $\vec{J}$ for each
star, and choose the closest $K=64$ neighbors in $\vec{J}$-space, with the
isotropic Euclidean metric distance; the neighbors are a function of the mass-model
paramters.
The integer $K=64$ was chosen empirically, but results are extremely insenstive
to this choice.

To measure the dependence of mean abundance-ratio deviation on vertical
conjugate angle $\theta_z$, we fit a smooth model of the form
\begin{equation}
  \Delta = a_0 + a_1\,\cos  \theta_z + b_1\,\sin    \theta_z
               + a_2\,\cos 2\theta_z + b_2\,\sin 2\,\theta_z \quad,
\end{equation}
where the five parameters are the parameters of a Fourier series to $m=2$.
We fit this model to all the individual abundance-ratio deviations $\Delta$
without binning, by least-square fitting with uniform weights.
Binned means and some of these smooth fits are shown in
\figurename~\ref{fig:sinusoid-fits}.
Although we show binned means, no binning is performed at any time in performing
these fits.
Results are shown in \figurename~\ref{fig:sinusoid-fits}
just for abundance deviations in $\mgfe$, and just for a few
settings of the mass-model parameter APW-PARAMETER-NAME.
\begin{figure}[!tp] % Notebook: figures/Abundance-anomaly-bootstrap.ipynb
  \begin{center}
  \includegraphics[width=\textwidth]{sinusoid-fits.pdf}
  \end{center}
  \caption{%
    The mean $\mgfe$ abundance deviation for as a function of vertical angle, for three
    different values of the mass of the disk (all, as you will recall, at fixed
    circular velocity at the Solar circle).
    The abundance deviation for each star in the sample
    is the difference between the abundance measured in
    each star and a mean of the $K=64$ nearest neighbors to that star in three-
    dimensional action space (for that mass model).
    In each panel, the mean abundance deviation is shown three ways. The black
    histogram shows the mean of the abundance deviation in small bins in vertical
    angle.
    The blue lines show continuous fits to the data (the unbinned data on the
    individual stars, not the binned data) which are continuous linear combinations of
    sines and cosines (see text). There are 128 blue lines, one for each of
    128 independent bootstrap trials.
    The red line shows the mean of the $\cos 2\,\theta_z$ terms across the
    128 bootstrap trials.
    Although the black line shows binned means for visualization purposes,
    these bins are never used in the analysis, as binning is sinning.
    Comparing the three panels, the red curves
    shows an amplitude of opposite sign in the highest-disk-mass panel relative to
    the other panels, suggesting that
    the best setting of the disk mass is in between the fiducial disk mass model
    and the higher-disk-mass model (as we find; see text).
  \label{fig:sinusoid-fits}
  }
\end{figure}

To obtain uncertainties on these smooth fits,
we perform bootstrap resamplings of the data.
The data are bootstrapped prior to the construction of the abundance deviations,
because the abundance-deviation estimates depend on the data set in play, and also
the mass-model parameters.
\figurename~\ref{fig:sinusoid-fits} shows the smooth fits for the bootstrap resamplings.

In this smooth model, parameter $a_1$ is sensitive to the vertical component
($v_z$ component) of the local standard of rest or the Solar motion.
Parameter $b_1$ is sensitive to the vertical ($z$) location of the disk midplane,
or the Solar position.
Parameter $a_2$ is sensitive to the local mass density concentrated in the disk,
or the disk-mass parameter APW.
This is shown in \figurename~\ref{fig:coeff-mdisk}, for the fits and bootstraps
performed for the $\mgfe$ abundance deviations.
Parameter $b_2$ should vanish; it is included as a test of model assumptions.
In detail it is sensitive to tilts in the coordinate system, and non-phase-mixed
structures.
\begin{figure}[!tp] % Notebook: figures/Abundance-anomaly-bootstrap.ipynb
  \begin{center}
  \includegraphics[width=\textwidth]{coeff-vs-mdisk.pdf}
  \end{center}
  \caption{%
    Parameters of the smooth sine-and-cosine fits
    to the dependence of \mgfe\ abundance deviation on vertical angle $\theta_z$
    (the blue lines in \figurename~\ref{fig:sinusoid-fits}),
    as a function of the disk-mass
    parameter \mratio. The data points show the values of the disk-mass
    parameter at which we performed the sine-and-cosine fits; the vertical error bars
    show the bootstrap uncertainties.
    The amplitude of the $\cos 2\theta_z$ term is
    the amplitude that is sensitive to the local density of the disk; it crosses
    zero when the model has the best-fit disk mass.
    The zero crossing and its measurement uncertainty are shown as a point and
    a horizontal error bar.
    The other terms shown have different dependences on paramters:
    The $\cos\theta_z$ would vary strongly if we varied the solar motion (the
    vertical component of the local standard of rest).
    The $\sin\theta_z$ term would vary strongly if we varied the location of the
    midplane of the disk.
    The $\sin 2\theta_z$ term cannot be non-zero; the fact that we find a non-zero
    value for this amplitude may suggest a weak violation of our model
    assumptions (see text).
    These figures show that we can precisely measure the disk mass, and also
    strongly suggest that the data want a different value for the disk midplane.
    APW TODO: add point with horizontal error bar showing zero-crossing value
    APW TODO: The x axis is properly ``$\mratio$''.
    APW TODO: Should we use the $a_1, b_1, a_2, b_2$ notation I use in the text here
    too?
  \label{fig:coeff-mdisk}
  }
\end{figure}

Also shown in \figurename~\ref{fig:coeff-mdisk} is an estimate for the disk
mass parameter APW and an associated uncertainty.
This estimate and uncertainty were obtained by linearly interpolating the
measurements and bootstrap error bars onto the $a_2=0$ line.

We have shown results for the $\mgfe$ abundance deviation, but we repeated
this analysis for several different abundances.
The full set of disk-mass measurements are shown in
\figurename{fig:inferred-mdisk-elems}.
The different abundances tell somewhat different stories, but the combined total
precision of this measurement is very high, on the order of APW~percent in the
mass of the Milky Way disk, locally.
% Notebook: figures/Abundance-anomaly-bootstrap.ipynb
\begin{figure}[!tp]
  \begin{center}
  \includegraphics[width=\textwidth]{mdisk-vs-elem.pdf}
  \end{center}
  \caption{%
    The measurements of the disk mass from each of several abundance ratios.
    The measurement shown in the $\cos 2\theta_z$ panel of
    \figurename~\ref{fig:coeff-mdisk} is shown here as the $\mgfe$ measurement.
    The band shows the inverse-variance-weighted mean value for the disk-mass
    parameter $\mratio$ and its formal uncertainty.
    This figure shows that the different element abundance ratios deliver somewhat
    inconsistent estimates for the disk mass; these inconsistencies are discussed
    in the text.
    APW TODO: The y axis is properly ``estimated $\mratio$''.
  \label{fig:inferred-mdisk-elems}
  }
\end{figure}

\section{Discussion}

HOGG: What did we find? How do our conclusions differ from those before us?

HOGG: In particular, what can we say about the dark disk etc?

HOGG: How is what we did better than what came before or happens by other methods?

How are we related to Jeans modeling?
HOGG ASKS: What to write here? How detailed should we be? Or should this just
go to the discussion section? HOGG SAY: Just move to the discussion. It should say that
we have the huge advantage that we never need to take a second moment (though we could);
our method applies to any moment. We have the disadvantage that we depend on the
existence of gradients. Fortunately these are not subtle. We have the huge advantage
that we don't depend on the selection (to first order). That's really huge. We don't
get help from separability; there is no need for it; it doesn't even simplify our
math in any way. That's a small but significant advantage. There is
no sense in which this method is a sub-method of Jeans or vice versa; they make use of
different aspects of the phase-mixed system.

HOGG: What are the limitations of what we did; what did we sacrifice for our benefits?

HOGG: Or we could phrase this as a set of failure modes?

HOGG: Return to the assumptions; do any need more discussion? One that does is the smooth
gradients assumption: If we choose different invariants to use, we get slightly different
answers, because (HOGG presumes) that the functional form for the abundance means fits
better or worse. So these results aren't definitive; we should probably use a more flexible
model for the abundance gradients, like a GP or etc.

HOGG: Another is the good abundances and selection assumptions: Do the abundances affect
the selection, and are the abundance measurements a function of stellar type? Either way,
we will inherit biases.

Does the existence of a non-zero ``verboten'' term imply a violation of our
assumptions?
Or is it just bad luck?

HOGG: What is the limit of this method as we go forward: Many abundance ratios? Many other
statistics of the abundance distribution? How do things change if the abundances track
each other exactly? Is that a problem? Note that we scale much better than chemical tagging
here.

HOGG: For example, we worked with the vertical angle $\theta_z$. It
would not have been a good idea to work with the azimuthal angle
$\theta_\phi$. Why not? Because the sample doesn't cover a large range
in $\theta_\phi$. But what about the angle $\theta_R$? If we had
worked with this angle we would have made an independent measurement
of the mass of the disk. We could also have used that angle to measure
the circular velocity, in the same way that the vertical angle can be
used to measure the local vertical standard of rest.

HOGG: What other tags could we have used? Other moments of other tags?
Combinations of tags? What might we gain?

Could we have used the \emph{other} actions as tags? Yes and no: Not if
their pdfs depend on selection, which they do.

HOGG: Finally, how sensitive are we, really, to the assumption of
phase mixing? In principle, very. But in practice: You can look at the
snail and see its aspect ratio. And that is literally a
non-phase-mixed structure. So there will be generalizations of this
method that don't depend as strongly on phase mixing. This connects,
conceptually, to work on streams in the Milky Way halo.

The flip side of that is that there are places in phase space where
mixing is maybe incredibly slow, like at low $J_z$. Maybe our disk
midplane issues come from this?

HOGG SAY: The fact that different abundances give
different disk masses, and the fact that the midplane is off, might
both be related. I think we should check whether the disk-mass results
become more consistent if we use a better disk midplane.

Points that came up in MPIA Galaxy Coffee (that is, make sure that we
have addressed all of these above):
\begin{itemize}
\item
  We don't require separability at all. We are working in 3-action
  space at all times. It is just that we are \emph{showing} the angles
  $\theta_z$ associated with the $z$-action $J_z$.
\item
  The orbits in Figure 1 look like bands not lines because they are
  projections of braided tori, not because it shows ``orbit families''
  or anything like that.
\item
  Why are we doing z, vz, and not R, vR, etc?
\item
  We don't depend on selection. Why not?
\item
  The point that we are assuming that stellar abundances don't vary as
  stars orbit (that is another way to describe this project).
\item
  That this could be used to calibrate or improve abundances, in
  principle!
\item
  That there is a fully data-driven formulation of this problem; ie, not
  parameterized.
\item
  The method does not require that the abundances uniquely define the
  actions, nor that the actions uniquely define the
  abundances. Everything can be probabilistically related.
\item
  What is the source of our scatter in our abundance means: Shot noise
  or wrongness of the assumptions?
\item
  Where is the information coming from? It is a combination of the
  density of stars in our sample, the amplitude of the gradient wrt
  action, and the sensitivity of that action and angle to the potential
  parameters.
\end{itemize}

\textbf{APW SAYS: Hogg text moved down here from earlier}

There are many ways to describe the fundamental prediction that underlies \methodname.
Here are a few:
\begin{itemize}
\item
  Stars don't change their abundances as they orbit!  Stellar
  abundance ratios can depend on the three invariant actions, but they
  can't depend on the conjugate angles, which wind up arbitrarily with time.
  This can be seen as a kinematic description of the concept underlying this \documentname.
\item
  Or, equivalently, abundance gradients taken in 6-dimensional phase space will be
  locally perpendicular, everywhere, to the orbital 3-tori in phase space.
  This is a local-geometry description of the concept.
\item
  Or, equivalently, at every location in 6-d phase space, there are a set of 6-d
  gradient vectors, which are the derivatives of all measurable
  moments of all measurable element-abundance ratios with respect to
  the 6 phase-space coordinates. These gradient vectors will span a
  local 3-d subspace, and this subspace will be orthogonal to the surfaces
  of the orbital tori at that location.
  This is a mathematics-of-gradients description.
\item
  Or, equivalently, the orbital tori will be level 3-surfaces in 6-d phase space of any
  moments or statistics of the element-abundance distribution.
  This is a global-geometry description.
\item
  Or, equivalently, a predictive model for the element abundances of stars
  that is given the freedom to depend on both actions and angles will do no
  better at predicting stellar element abundances than a model that is only
  given the freedom to depend on actions alone.
  This is an information-theory description.
\end{itemize}


We make this point clear in a different way in \figurename~YYY, in which
we have transformed into action--angle coordinates in phase space (CITE)
and we show scatterplots of the abundances as a function of conjugate
angles $\theta_z$, conjugate to the vertical actions $J_z$, for stars near
the orbits plotted in \figurename~XXX.
Using the fiducial potential to convert to actions and angles,
the abundance distribution is similar at different
angles $\theta_z$, or on different parts of the orbit.
Along the orbits generated by the low-mass-disk and high-mass-disk potentials,
the abundance distribution shows clear $m=2$ (or $\exp i\,2\,\theta_z$) dependences
on vertical angle $\theta_z$.
That is, just by plotting the abundances versus angle, we can make
inferences about the mass of the disk, or---more generally---the
gravitational potential of the Milky Way.

In order to make the abundance--angle plots in \figurename~YYY, we had
to DO SOME THINGS because we needed to visualize the global dependence
on angle using all the stars on all different kinds of orbits.
Because different orbits have different abundance-ratio
distributions, this is not a trivial transformation of the data.
In the inferences we do in \sectionname~AAA below, we
will use regression (frequentist) or forward modeling (Bayes) to
combine the data from stars on different orbits.

...The point that this works at one to three dimensions. It requires
abundance gradients, but not separability!  Of course you might not
have abundance gradients in all three action directions.

...The point that the method is combinatoric in abundance data.
...
One of the crazy things about all this is that any description of a general distribution in $D$-space
requires a \emph{lot of parameters}.
Even a trivial distribution---the Normal distribution---requires $0.5\,D\,(D+3)$ parameters for its
complete description, and anything more complex has more.
That means that there are a very large set of element-abundance statistics for which the
six-gradient exists or could be constraining for this project.
Not all of these parameters can be reliably measured in a finite data set,
let alone reliably seen to vary with phase-space location.
However, we choose to see this bug as a feature:
We have discovered, in effect, a \emph{combinatorically large set of constraints on the
dynamical actions and conjugate angles}.

...The point that this would be more complex in chaotic regions, and
maybe effectively inapplicable?

...The point that this doesn't depend on selection, provided that
stellar properties don't vary strongly with abundnaces, and that
abundance-measurement biases don't depend strongly on stellar
parameters. Both assumptions wrong in detail.

... The point that there will be frequentist statistics or
optimizations, and also Bayesian approaches.  The point that Bayes and
frequentism look very different here. Call out to orbital roulette,
and to Bovy et al.

\acknowledgments
It is a pleasure to thank
  Melissa Ness (Columbia),
  who started the conversation that started this project, many years ago.
We also thank
  Jo Bovy (Toronto),
  Anna-Christina Eilers (MIT),
  Suroor S. Gandhi (NYU),
  David Spergel (Flatiron),
  Eugene Vasiliev (Cambridge),
  the Dynamics and Astronomical Data groups at the Flatiron Institute,
  and the Galaxy group at the MPIA
for valuable discussions and input.
DWH was partially supported by HOGG GRANT DETAILS.
HWR was partially supported by GRANT DETAILS.
This research was conducted in part at the Aspen Center for Physics,
which is supported by National Science Foundation grant \acronym{PHY-1607611}.

SDSS or whatever SPECTROSCOPY ack?

This work has made use of data from the European Space Agency (\acronym{ESA})
mission \gaia\ (\url{https://www.cosmos.esa.int/gaia}), processed by the \gaia\
Data Processing and Analysis Consortium (\acronym{DPAC},
\url{https://www.cosmos.esa.int/web/gaia/dpac/consortium}). Funding for the
\acronym{DPAC}
has been provided by national institutions, in particular the institutions
participating in the \gaia\ Multilateral Agreement.

% \facilities{
% \sdss-iv,
% \apogee,
% \gaia
% }

\software{
  \package{Astropy} \citep{astropy, astropy:2018},
  \package{IPython} \citep{ipython},
  \package{matplotlib} \citep{matplotlib},
  \package{numpy} \citep{numpy},
  \package{gala} \citep{gala, galav1_1},
  \package{schwimmbad} \citep{schwimmbad}
}

\bibliographystyle{aasjournal}
\bibliography{stationary-tags}

\end{document}
